<!DOCTYPE html>
<html lang="fr">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="myPlaylist">
    <meta content='width=device-width, initial-scale=1.0' name='viewport'/>
    <link rel="shortcut icon" href="faviconMyPlaylist.png">
    <title>myPlaylist • Planetcode.fr</title>
    <link rel="stylesheet" href="css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.3.11/slick.css" />
</head>

<body>

    <div class="navbar">

        <a href="http://playlist.planetcode.fr">
            <span style="font-size:40px;position:absolute;z-index:-1;color:red;margin-top:5px;margin-left:-34px;"><i class="far fa-play-circle"></i></span>

            <p class="main-logo" style="margin-top:12px;font-weight:bold;">
                <span style="font-size:16px;">my</span>
                <span style="font-size:30px;letter-spacing: 3px;">PL</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size:30px;letter-spacing: 3px;margin-left:-3px">YLIST</span>
            </p>
        </a>

    </div>

    <!-- Slick Slider -->
    <section class="slider">
        <div id="slide_1"></div>
        <div id="slide_2"></div>
        <div id="slide_3"></div>

    </section>

    <!-- Fancybox gallery -->
    <section class="second clearfix" id="results_box">

        <!-- Format attendu qui va être "mappé" après le "fetch" des données JSON -->
        <!--<article class="video">
            <figure>
                <a class="fancybox fancybox.iframe" href="//www.youtube.com/embed/zH3ZohGnjcg"><img class="videoThumb" src="http://i1.ytimg.com/vi/zH3ZohGnjcg/mqdefault.jpg"></a>
            </figure>
            <h2 class="videoTitle">Kumru Ballad</h2>
        </article>-->

    </section>

    <footer>

        <p style="font-size:14px;">Réalisation : <a href="http://portfolio.planetcode.fr/" target="_blank">Jean-Eudes Nouaille-Degorce</a>
            <p>

                <p style="font-size:14px;color:grey;">Développeur Full Stack &nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.linkedin.com/in/jean-eudes-nouaille-degorce/" target="_blank" style="color: white;"><i class="fab fa-linkedin fa-2x" style="font-size: 24px;"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://github.com/JEND-CODES" target="_blank" style="color: white;"><i class="fab fa-github fa-2x" style="font-size: 24px;"></i></a></p>

                <a href="#" class="scroll-top">↑</a>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <!-- Pour régler les options d'ouverture et de fermeture des iframe et autres.. -->
    <script src="js/global.min.js"></script>
    <script src="//cdn.jsdelivr.net/jquery.slick/1.3.11/slick.min.js"></script>

    <script>
        $(document).ready(function() {

            $(".slider").slick({
                autoplay: false,
                dots: true,
                arrows: false,
                slidesToShow: 1,
                slidesToScroll: 1,

                customPaging: function(slider, i) {
                    return '<i class="fas fa-circle"></i>';
                },

                responsive: [{
                    breakpoint: 500,
                    settings: {
                        dots: true,
                        arrows: false,
                        infinite: true,
                        slidesToShow: 1,
                        slidesToScroll: 1
                    }
                }]
            });
        });

    </script>

    <script>
        const show_result_slide_1 = document.getElementById('slide_1');
        const show_result_slide_2 = document.getElementById('slide_2');
        const show_result_slide_3 = document.getElementById('slide_3');

        const url_2 = 'myplaylist_v1.json';

        const returnContent_2 = (element_2) => {
            return document.createElement(element_2);
        }
        const append_2 = (parent_2, el_2) => {
            return parent_2.appendChild(el_2);
        }

        fetch(url_2)
            .then((response_2) => {
                return response_2.json();
            })
            .then(data_2 => {

                // Génère la video n°1 en Une sur le slider
                let result_slide_1 = data_2[0].body;
                // console.log(result_slide_1);

                let new_span_slide_1 = returnContent_2('span');

                new_span_slide_1.innerHTML = `
        
                    <iframe class="slick-iframe" src="${result_slide_1}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    
                    `;

                if (result_slide_1.substring(0, 8) == 'https://') {
                    append(show_result_slide_1, new_span_slide_1);
                } else {
                    $('#slide_1').css('display', 'none');
                };


                // Génère la video n°2 en Une sur le slider
                let result_slide_2 = data_2[1].body;
                // console.log(result_slide_2);

                let new_span_slide_2 = returnContent_2('span');

                new_span_slide_2.innerHTML = `
        
                    <iframe class="slick-iframe" src="${result_slide_2}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    
                    `;

                if (result_slide_2.substring(0, 8) == 'https://') {
                    append(show_result_slide_2, new_span_slide_2);
                } else {
                    $('#slide_2').css('display', 'none');
                };


                // Génère la video n°3 en Une sur le slider
                let result_slide_3 = data_2[2].body;
                // console.log(result_slide_3);

                let new_span_slide_3 = returnContent_2('span');

                new_span_slide_3.innerHTML = `
        
                    <iframe class="slick-iframe" src="${result_slide_3}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    
                    `;

                if (result_slide_3.substring(0, 8) == 'https://') {
                    append(show_result_slide_3, new_span_slide_3);
                } else {
                    $('#slide_3').css('display', 'none');
                };


            })
            .catch(error => {
                console.log(error);
            })

    </script>

    <script>
        const show_results = document.getElementById('results_box');
        const url = 'myplaylist_v1.json';
        const returnContent = (element) => {
            return document.createElement(element);
        }
        const append = (parent, el) => {
            return parent.appendChild(el);
        }

        fetch(url)
            .then((response) => {
                return response.json();
            })
            .then(data => {
                //let results = data;

                // Slice des trois premiers résultats
                // La méthode slice() copie une partie donnée d'un tableau et renvoie cette partie copiée en tant que nouveau tableau. Cela ne change pas le tableau d'origine
                // array.slice(from, until);
                let results = data.slice(3);

                // console.log(data);

                return results.map(res_filter => {

                    let new_div = returnContent('div'),
                        new_span = returnContent('span');

                    // Permet de récupérer le code unique de chaque vidéo en "splitant" l'url youtube-embed (présente dans les datas de l'API), puis d'intégrer ce code unique dans l'url spécifique qui génère les thumbnails youtube           
                    let unique_video_code = res_filter.body.split('https://www.youtube.com/embed/');

                    // console.log(unique_video_code[1]);

                    new_span.innerHTML = `

                    <article class="video" style="background-color:transparent;">

                        <figure style="overflow:hidden;border:2px solid #222;">

                        <a class="fancybox fancybox.iframe" href="${res_filter.body}">

                            <img class="videoThumb" style="margin-top:-30px;" src="http://i3.ytimg.com/vi/${unique_video_code[1]}/hqdefault.jpg">

                        </a>

                        </figure>

                    <h2><span style="color:white;">
                    ${res_filter.author}</span>
                    <br />
                    <span style="color:grey">${res_filter.title}</span>
                    </h2>

                  </article>
                    
                    `;

                    // On vérifie que le titre n'est pas vide, que l'url de l'iframe commence bien par "https://" (8 premiers caractères)
                    if (res_filter.title != '' && res_filter.body.substring(0, 8) == 'https://') {
                        append(new_div, new_span);
                        append(show_results, new_div);
                    }

                });

            })
            .catch(error => {
                console.log(error);
            })

    </script>

</body>

</html>
